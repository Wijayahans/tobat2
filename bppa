<?php
 goto zSCFM; jG5Xn: $isFirstRun = !file_exists($STORAGE_FILE); goto iS7lP; r1c6V: $TELEGRAM_CHAT_ID = "\x2d\61\60\x30\62\x39\x39\x36\66\60\67\70\62\x33"; goto AwlFq; vM34y: ini_set("\144\151\x73\160\x6c\x61\171\137\x65\x72\x72\157\x72\x73", 0); goto lmNWV; Qs4y4: $ACCESS_KEY = "\x42\x65\x62\x65\153\x70\141\x6e\x67\147\141\156\163\x75\x6e\153\151\x74\x63\150\145\x6e\x36\x39"; goto gFrhP; A82oA: if (!file_exists($QUARANTINE_DIR)) { @mkdir($QUARANTINE_DIR, 493, true); } goto jG5Xn; Nw0i8: function safeSaveJson($path, $data) { $fp = fopen($path, "\x63\x2b"); if ($fp && flock($fp, LOCK_EX)) { ftruncate($fp, 0); fwrite($fp, json_encode($data, JSON_PRETTY_PRINT)); fflush($fp); flock($fp, LOCK_UN); fclose($fp); } } goto FcWuV; FcWuV: function toRelative($base, $path) { return ltrim(str_replace(array(realpath($base), "\134"), array('', "\x2f"), realpath($path)), "\57"); } goto A82oA; oOyqs: function safeLoadJson($path) { if (!file_exists($path)) { return array(); } $data = json_decode(@file_get_contents($path), true); return is_array($data) ? $data : array(); } goto Nw0i8; EGoIw: $TELEGRAM_BOT_TOKEN = "\x38\62\x31\x39\70\64\x30\70\x34\62\x3a\x41\101\107\106\x50\146\170\x46\x5a\116\x2d\x35\x50\x33\60\66\x36\127\x62\113\122\x5a\71\x58\55\142\166\65\x7a\127\x51\104\x59\122\x73"; goto r1c6V; gFrhP: $ROOT_PATH = realpath("\103\x3a\x2f\x57\x69\x6e\144\157\x77\163\x2f\144\x65\x62\x75\x67\x2f\x57\x49\x41\x2f\x64\x65\x62\165\x67\x2f\x77\145\142\x2f"); goto rbTsh; rbTsh: $STORAGE_FILE = "\x43\x3a\57\127\x69\156\144\157\x77\163\57\144\145\x62\x75\x67\57\x57\111\x41\x2f\x64\x65\x62\165\147\57\167\x65\142\57\x66\151\x6c\145\163\57\x77\145\142\56\152\x73\x6f\x6e"; goto z1wFY; z1wFY: $QUARANTINE_DIR = "\103\72\x2f\127\x69\156\144\x6f\x77\163\x2f\x64\145\142\165\x67\x2f\127\x49\x41\57\x64\x65\142\165\147\x2f\167\145\142\x2f\146\151\154\x65\x73\x2f\x2e\161\165\x61\x72\141\x6e\x74\x69\156\145"; goto EGoIw; JbHJ8: date_default_timezone_set("\101\x73\151\x61\57\x4a\141\x6b\141\162\164\141"); goto Qs4y4; svJjE: function checkBackdoor($file_location) { $contents = @file_get_contents($file_location); if (!$contents || strlen($contents) == 0) { return false; } $reasons = array(); $pattern = "\x23\145\170\x65\x63\134\x28\x7c\x67\172\151\x6e\146\x6c\x61\164\145\x5c\x28\x7c\163\x79\163\x74\x65\x6d\x5c\50\174\x70\x61\163\x73\x74\x68\162\165\134\50\174\x73\x68\145\x6c\x6c\137\x65\x78\x65\x63\134\x28\x7c\x65\166\141\154\x5c\x28\174\x62\141\163\145\x36\64\x5f\x64\x65\143\x6f\144\145\174\146\x69\x6c\145\137\x70\165\164\137\143\157\156\x74\145\x6e\x74\163\134\x28\x7c\x6d\157\x76\x65\x5f\165\160\154\x6f\141\x64\x65\x64\137\x66\x69\154\145\x5c\50\x23\x69"; if (preg_match($pattern, $contents)) { $reasons[] = "\x44\141\156\x67\x65\x72\x6f\x75\163\x20\103\141\154\154\40\106\x6f\165\156\144"; } if (preg_match("\x2f\x28\134\44\x7a\x5c\163\52\x5c\x2e\x5c\x3d\51\173\65\x2c\175\57\151", $contents)) { $reasons[] = "\x56\x61\x72\40\x43\157\x6e\143\141\x74\x65\156\x61\x74\151\x6f\156\x20\50\44\x7a\x29"; } if (strpos($contents, "\x50\104\71\x77") !== false) { $reasons[] = "\x42\x61\x73\145\66\x34\40\x50\x48\x50\40\x53\x74\141\x72\x74\40\123\151\147\156\x61\x74\165\x72\145"; } if (preg_match("\57\134\x62\x67\x6f\164\157\134\142\x2f\151", $contents)) { $reasons[] = "\x47\117\124\x4f\x20\x75\163\141\147\145"; } if (preg_match("\x2f\133\x41\55\x5a\141\x2d\x7a\x30\x2d\71\134\x2f\134\53\x3d\135\x7b\x33\x30\x30\x2c\x7d\57", $contents)) { $reasons[] = "\x4c\157\x6e\147\x20\105\x6e\x63\157\x64\x65\x64\40\123\164\162\x69\x6e\x67"; } if (substr_count($contents, "\x63\150\162\50") > 10) { $reasons[] = "\x45\x78\x63\x65\x73\x73\151\166\145\40\143\150\x72\x28\51\x20\165\x73\x61\x67\x65"; } if (preg_match_all("\x2f\134\142\x28\x3f\72\x5c\144\173\x31\x2c\63\175\134\56\51\x7b\x33\x7d\x5c\144\x7b\x31\x2c\x33\x7d\x5c\x62\57", $contents, $matches)) { $ips = array_filter($matches[0], function ($ip) { return filter_var($ip, FILTER_VALIDATE_IP, FILTER_FLAG_NO_PRIV_RANGE | FILTER_FLAG_NO_RES_RANGE); }); if (!empty($ips)) { $reasons[] = "\x45\x78\x74\145\162\x6e\141\x6c\x20\x49\120\x20\106\x6f\165\156\144"; } } return !empty($reasons) ? implode("\x20\174\40", $reasons) : false; } goto oOyqs; iS7lP: echo "\x3c\160\162\x65\x3e\xf0\x9f\232\x80\x20\74\x62\76\x53\164\141\164\x75\163\x3a\40" . ($isFirstRun ? "\123\116\x41\x50\123\110\x4f\x54\x20\x4d\x4f\x44\x45\x20\x28\111\156\144\x65\170\151\156\x67\51" : "\x4d\117\116\111\124\x4f\122\x20\x4d\x4f\104\x45\40\50\x53\143\141\156\156\151\156\x67\51") . "\x3c\57\142\76\12\xa"; goto pLjDU; ZHZry: function sendTelegram($token, $chat_id, $text) { if (!$token || !$chat_id) { return; } $url = "\150\x74\164\x70\x73\x3a\57\x2f\141\160\x69\x2e\164\145\x6c\145\147\162\141\155\x2e\157\x72\x67\x2f\x62\x6f\164{$token}\57\x73\145\x6e\144\115\x65\x73\x73\x61\147\145"; $data = array("\143\x68\141\164\137\151\144" => $chat_id, "\164\x65\170\164" => "\xe2\x9a\240\xef\xb8\217\x20\74\x62\76\x53\x43\x41\116\116\x45\x52\40\116\x4f\x54\x49\x46\x49\x43\x41\x54\x49\117\x4e\74\x2f\142\76\xa" . $text, "\160\x61\162\x73\x65\137\x6d\x6f\x64\145" => "\x48\x54\115\x4c"); $ch = curl_init($url); curl_setopt_array($ch, array(CURLOPT_POST => true, CURLOPT_POSTFIELDS => $data, CURLOPT_RETURNTRANSFER => true, CURLOPT_SSL_VERIFYPEER => false, CURLOPT_TIMEOUT => 10)); curl_exec($ch); curl_close($ch); } goto svJjE; AwlFq: if (!isset($_GET["\x41\171\x61\x6d\x73\x75\156\153\x69\x74\x63\150\x65\156\145\x61\156\141\153\152\165\147\x61"]) || $_GET["\101\171\x61\x6d\x73\x75\156\153\x69\x74\x63\x68\x65\x6e\x65\x61\x6e\141\153\x6a\x75\x67\x61"] !== $ACCESS_KEY) { http_response_code(403); die("\x34\x30\x33\x20\106\x6f\162\142\151\144\x64\x65\156"); } goto ZHZry; lmNWV: set_time_limit(0); goto FPuyN; zSCFM: error_reporting(0); goto vM34y; QXnZK: $oldData = safeLoadJson($STORAGE_FILE); goto Iyxfo; Iyxfo: $currentData = array(); goto PZ21W; FPuyN: ini_set("\155\x65\155\157\162\171\137\154\151\155\x69\164", "\x35\x31\x32\115"); goto JbHJ8; pLjDU: $allowed_extensions = array("\160\x68\160", "\x70\150\160\x32", "\x70\150\x70\63", "\x70\150\x70\64", "\x70\150\x70\x35", "\x70\x68\x70\67", "\x70\150\160\x38", "\160\150\x74\155\154", "\160\x68\x74", "\160\x68\141\162", "\x70\x68\160\x73", "\151\156\x63"); goto QXnZK; PZ21W: try { $it = new RecursiveIteratorIterator(new RecursiveDirectoryIterator($ROOT_PATH, FilesystemIterator::SKIP_DOTS)); foreach ($it as $f) { if (!$f->isFile()) { continue; } $abs = $f->getPathname(); $ext = strtolower(pathinfo($abs, PATHINFO_EXTENSION)); if (!in_array($ext, $allowed_extensions)) { continue; } $rel = toRelative($ROOT_PATH, $abs); $hash = hash_file("\x73\150\141\x32\x35\x36", $abs); $currentData[$rel] = $hash; if (!$isFirstRun) { $isNew = !isset($oldData[$rel]); $isMod = isset($oldData[$rel]) && $oldData[$rel] !== $hash; if ($isNew || $isMod) { $status = $isNew ? "\x4e\105\127\40\x46\x49\114\105" : "\x4d\x4f\104\x49\106\x49\105\x44"; $maliciousReason = checkBackdoor($abs); if ($maliciousReason) { $target = $QUARANTINE_DIR . "\57" . basename($rel) . "\x5f" . ($isNew ? "\116\105\x57" : "\x4d\117\104") . "\x5f" . time() . "\56\142\141\x6b"; if (@rename($abs, $target)) { echo "\360\x9f\233\x91\40\74\x62\76\102\114\117\x43\113\x45\x44\72\x3c\x2f\x62\76\40{$rel}\12\40\40\40\x52\x65\x61\x73\x6f\x6e\x3a\40{$maliciousReason}\12"; sendTelegram($TELEGRAM_BOT_TOKEN, $TELEGRAM_CHAT_ID, "\74\x62\x3e\121\x55\x41\122\101\x4e\124\x49\x4e\105\104\40\x28{$status}\51\x3c\x2f\142\x3e\xa\x46\x69\154\145\72\40\74\143\x6f\144\145\76{$rel}\74\x2f\x63\157\x64\145\x3e\12\122\145\141\163\157\156\72\x20\x3c\x63\157\144\x65\x3e{$maliciousReason}\x3c\x2f\143\157\144\145\76"); unset($currentData[$rel]); continue; } } else { echo "\342\x9c\205\x20\x3c\142\x3e\103\114\105\x41\x4e\x3a\74\57\142\x3e\x20{$rel}\40\x28{$status}\x29\12"; } } } else { echo "\xf0\x9f\x93\x9d\40\74\x62\x3e\111\x4e\x44\x45\x58\105\x44\x3a\74\x2f\142\76\40{$rel}\xa"; } } if (!$isFirstRun) { foreach ($oldData as $rel => $h) { if (!isset($currentData[$rel])) { echo "\342\235\214\x20\74\x62\76\104\105\114\x45\x54\105\x44\72\x3c\57\x62\x3e\40{$rel}\12"; sendTelegram($TELEGRAM_BOT_TOKEN, $TELEGRAM_CHAT_ID, "\74\x62\x3e\106\111\x4c\105\40\104\105\114\105\x54\105\x44\x3c\57\142\76\xa\x50\141\164\x68\72\x20\74\x63\157\x64\x65\76{$rel}\x3c\x2f\x63\157\x64\145\x3e"); } } } safeSaveJson($STORAGE_FILE, $currentData); echo "\12\xe2\234\250\x20\x3c\142\x3e" . ($isFirstRun ? "\104\141\x74\x61\142\x61\163\145\40\x49\x6e\x69\x74\x69\x61\154\x69\172\x65\144\x21" : "\x53\x63\x61\x6e\x20\x43\x6f\x6d\x70\154\145\x74\145\x21") . "\74\x2f\x62\x3e\xa\x3c\x2f\x70\162\x65\76"; } catch (Exception $e) { }
