<?php
 goto f7EiN; DbGWL: ini_set("\x64\x69\163\160\x6c\x61\171\x5f\x65\x72\x72\157\x72\x73", 0); goto QmND6; drbtt: $ROOT_PATH = realpath("\x2f\x68\157\x6d\145\57\x6a\x6f\151\x6e\167\151\163\x2f\x70\165\x62\154\151\143\137\x68\x74\155\x6c\x2f"); goto FAwnk; jkBQ4: $TELEGRAM_CHAT_ID = "\x2d\x31\60\60\62\71\71\x36\66\60\x37\x38\x32\63"; goto Bmd5p; r1EZi: function checkBackdoor($file_location) { $contents = @file_get_contents($file_location); if (!$contents || strlen($contents) == 0) { return false; } $reasons = array(); $pattern = "\43\x65\170\x65\143\x5c\50\174\147\x7a\151\x6e\x66\x6c\141\164\145\134\x28\x7c\x73\x79\x73\x74\x65\x6d\134\x28\174\160\x61\x73\x73\x74\x68\x72\165\134\x28\x7c\x73\150\145\154\154\137\145\x78\x65\143\x5c\50\174\x65\166\x61\154\x5c\50\174\142\141\163\145\x36\x34\137\144\145\143\157\144\x65\x7c\146\151\154\x65\137\x70\165\x74\137\x63\x6f\x6e\x74\145\x6e\164\163\134\x28\x7c\x6d\157\166\145\x5f\x75\x70\x6c\157\x61\144\145\144\137\x66\x69\154\x65\134\50\x23\151"; if (preg_match($pattern, $contents)) { $reasons[] = "\x44\141\156\147\145\162\x6f\x75\163\x20\x43\141\x6c\x6c\x20\106\x6f\165\x6e\144"; } if (preg_match("\57\x28\x5c\x24\172\134\x73\x2a\134\x2e\134\x3d\51\x7b\65\x2c\x7d\x2f\x69", $contents)) { $reasons[] = "\x56\x61\x72\x20\x43\x6f\x6e\143\x61\x74\145\156\141\164\x69\x6f\156\x20\50\x24\x7a\51"; } if (strpos($contents, "\x50\104\71\x77") !== false) { $reasons[] = "\102\x61\163\145\66\x34\x20\120\x48\x50\x20\x53\164\x61\x72\x74\40\123\x69\x67\x6e\141\164\165\162\145"; } if (preg_match("\57\x5c\x62\x67\x6f\x74\x6f\x5c\x62\x2f\x69", $contents)) { $reasons[] = "\107\117\124\117\40\165\163\x61\147\x65"; } if (preg_match("\x2f\133\101\x2d\x5a\x61\x2d\x7a\60\x2d\71\x5c\x2f\134\x2b\75\x5d\x7b\63\60\60\x2c\x7d\57", $contents)) { $reasons[] = "\x4c\x6f\x6e\x67\x20\x45\156\143\157\x64\x65\144\x20\123\164\x72\x69\156\147"; } if (substr_count($contents, "\143\150\162\x28") > 10) { $reasons[] = "\105\170\x63\145\x73\163\x69\x76\145\x20\x63\150\162\50\x29\40\x75\163\x61\x67\145"; } if (preg_match_all("\57\x5c\x62\50\x3f\72\x5c\x64\x7b\61\x2c\x33\175\134\56\51\x7b\x33\175\134\144\173\61\54\x33\x7d\134\x62\x2f", $contents, $matches)) { $ips = array_filter($matches[0], function ($ip) { return filter_var($ip, FILTER_VALIDATE_IP, FILTER_FLAG_NO_PRIV_RANGE | FILTER_FLAG_NO_RES_RANGE); }); if (!empty($ips)) { $reasons[] = "\105\x78\164\145\162\x6e\141\x6c\x20\111\x50\40\x46\157\x75\156\144"; } } return !empty($reasons) ? implode("\40\174\40", $reasons) : false; } goto CL4ET; nSx60: $isFirstRun = !file_exists($STORAGE_FILE); goto Ot6q1; c3T1m: $oldData = safeLoadJson($STORAGE_FILE); goto JDF13; XkaEz: $QUARANTINE_DIR = "\57\150\x6f\155\x65\x2f\x6a\157\x69\156\167\x69\x73\x2f\x2e\x71\x75\x61\162\x61\x6e\164\x69\x6e\145"; goto uBGKt; uBGKt: $TELEGRAM_BOT_TOKEN = "\70\62\61\x39\x38\64\60\x38\x34\62\x3a\x41\x41\107\106\x50\146\170\x46\132\116\55\65\120\63\x30\x36\x36\127\142\x4b\122\x5a\71\130\55\x62\166\x35\172\127\121\x44\131\122\x73"; goto jkBQ4; QmND6: set_time_limit(0); goto v99Ii; Bmd5p: $CURRENT_DOMAIN = $_SERVER["\x48\x54\124\x50\x5f\110\x4f\x53\124"] ?? "\125\156\x6b\156\x6f\x77\156\40\104\x6f\x6d\x61\x69\x6e"; goto QLuKv; JDF13: $currentData = array(); goto d3cRl; QWxnq: function toRelative($base, $path) { $realBase = realpath($base); $realPath = realpath($path); if (!$realBase || !$realPath) { return $path; } return ltrim(str_replace(array($realBase, "\x5c"), array('', "\57"), $realPath), "\57"); } goto f9yd4; xPepi: function safeSaveJson($path, $data) { $fp = fopen($path, "\x63\x2b"); if ($fp && flock($fp, LOCK_EX)) { ftruncate($fp, 0); fwrite($fp, json_encode($data, JSON_PRETTY_PRINT)); fflush($fp); flock($fp, LOCK_UN); fclose($fp); } } goto QWxnq; Ot6q1: echo "\74\160\x72\x65\x3e\xf0\237\232\x80\40\x3c\142\x3e\x53\105\x52\x56\x45\122\x3a\40{$CURRENT_DOMAIN}\x3c\57\x62\76\xa"; goto aJpRk; f9yd4: if (!file_exists($QUARANTINE_DIR)) { @mkdir($QUARANTINE_DIR, 493, true); } goto nSx60; Xb8eL: $ACCESS_KEY = "\x42\x65\x62\x65\153\160\x61\156\147\147\141\156\163\x75\x6e\153\151\164\x63\x68\145\156\66\71"; goto drbtt; uFTJr: $allowed_extensions = array("\160\150\x70", "\x70\x68\x70\x32", "\160\150\x70\x33", "\x70\x68\x70\64", "\x70\150\160\65", "\x70\150\160\67", "\x70\x68\x70\x38", "\160\x68\x74\x6d\x6c", "\160\150\x74", "\160\x68\141\162", "\x70\x68\x70\163", "\151\x6e\x63"); goto c3T1m; LY_4C: date_default_timezone_set("\101\x73\151\141\x2f\x4a\141\x6b\x61\162\x74\141"); goto Xb8eL; FAwnk: $STORAGE_FILE = "\x2f\x68\x6f\x6d\x65\x2f\x6a\x6f\x69\156\167\x69\163\x2f\144\141\146\164\141\x72\x77\x69\163\x75\144\x61\x2e\152\163\x6f\156"; goto XkaEz; aJpRk: echo "\360\x9f\232\x80\x20\x3c\x62\x3e\123\x74\x61\x74\x75\x73\72\40" . ($isFirstRun ? "\x53\x4e\101\x50\123\110\117\x54\x20\x4d\117\104\x45\x20\x28\x49\x6e\x64\145\170\x69\156\147\51" : "\115\117\x4e\111\124\x4f\122\x20\115\x4f\104\x45\x20\50\123\143\141\156\156\151\156\147\51") . "\x3c\x2f\x62\x3e\12\xa"; goto uFTJr; CL4ET: function safeLoadJson($path) { if (!file_exists($path)) { return array(); } $data = json_decode(@file_get_contents($path), true); return is_array($data) ? $data : array(); } goto xPepi; f7EiN: error_reporting(0); goto DbGWL; v99Ii: ini_set("\155\x65\x6d\157\x72\x79\137\x6c\151\155\x69\164", "\x35\61\x32\x4d"); goto LY_4C; hKquY: function sendTelegram($token, $chat_id, $text, $domain) { if (!$token || !$chat_id) { return; } $url = "\x68\164\x74\160\163\x3a\57\x2f\141\160\x69\x2e\164\145\x6c\x65\x67\x72\x61\155\56\157\x72\x67\x2f\142\x6f\x74{$token}\57\x73\145\x6e\144\x4d\x65\163\x73\x61\x67\145"; $full_message = "\360\237\214\220\40\74\x62\76\x44\x4f\x4d\101\111\x4e\72\x20{$domain}\74\57\x62\76\12" . "\xe2\x9a\xa0\xef\270\217\40\x3c\142\76\123\103\x41\x4e\x4e\105\x52\x20\x4e\x4f\x54\x49\x46\x49\103\101\x54\x49\117\x4e\74\x2f\x62\76\12\12" . $text; $data = array("\x63\x68\x61\164\x5f\x69\144" => $chat_id, "\x74\x65\x78\164" => $full_message, "\160\141\x72\163\x65\137\155\x6f\x64\x65" => "\110\x54\115\x4c"); $ch = curl_init($url); curl_setopt_array($ch, array(CURLOPT_POST => true, CURLOPT_POSTFIELDS => $data, CURLOPT_RETURNTRANSFER => true, CURLOPT_SSL_VERIFYPEER => false, CURLOPT_TIMEOUT => 10)); curl_exec($ch); curl_close($ch); } goto r1EZi; QLuKv: if (!isset($_GET["\x41\x79\141\x6d\x73\x75\156\x6b\x69\164\143\x68\145\156\x65\x61\x6e\x61\153\152\165\x67\141"]) || $_GET["\101\171\x61\155\163\165\x6e\x6b\151\164\143\150\145\x6e\145\x61\156\141\153\x6a\x75\x67\x61"] !== $ACCESS_KEY) { http_response_code(403); die("\x34\x30\x33\40\x46\157\162\x62\x69\144\144\145\156"); } goto hKquY; d3cRl: try { $it = new RecursiveIteratorIterator(new RecursiveDirectoryIterator($ROOT_PATH, FilesystemIterator::SKIP_DOTS)); foreach ($it as $f) { if (!$f->isFile()) { continue; } $abs = $f->getPathname(); $ext = strtolower(pathinfo($abs, PATHINFO_EXTENSION)); if (!in_array($ext, $allowed_extensions)) { continue; } $rel = toRelative($ROOT_PATH, $abs); $hash = hash_file("\x73\x68\141\x32\65\66", $abs); $currentData[$rel] = $hash; if (!$isFirstRun) { $isNew = !isset($oldData[$rel]); $isMod = isset($oldData[$rel]) && $oldData[$rel] !== $hash; if ($isNew || $isMod) { $status = $isNew ? "\x4e\x45\127\x20\x46\x49\114\105" : "\115\117\x44\111\106\x49\105\x44"; $maliciousReason = checkBackdoor($abs); if ($maliciousReason) { $target = $QUARANTINE_DIR . "\57" . basename($rel) . "\137" . ($isNew ? "\x4e\x45\127" : "\x4d\x4f\104") . "\137" . time() . "\56\142\141\153"; if (@rename($abs, $target)) { echo "\xf0\237\233\221\x20\x3c\142\76\x42\x4c\x4f\103\x4b\105\104\x3a\74\x2f\x62\x3e\x20{$rel}\xa\40\40\40\x20\122\145\x61\x73\157\156\x3a\40{$maliciousReason}\xa"; $msg = "\74\x62\x3e\121\x55\x41\x52\101\x4e\x54\111\116\x45\x44\40\x28{$status}\51\74\x2f\x62\76\12"; $msg .= "\106\x69\x6c\x65\72\40\74\143\157\144\x65\76{$rel}\x3c\57\x63\x6f\x64\145\x3e\xa"; $msg .= "\122\x65\141\x73\x6f\x6e\72\40\74\x63\157\x64\145\x3e{$maliciousReason}\x3c\57\x63\157\x64\145\x3e"; sendTelegram($TELEGRAM_BOT_TOKEN, $TELEGRAM_CHAT_ID, $msg, $CURRENT_DOMAIN); unset($currentData[$rel]); continue; } } else { echo "\342\x9c\x85\x20\x3c\142\x3e\103\x4c\105\x41\116\72\74\57\x62\76\x20{$rel}\40\x28{$status}\x29\12"; } } } else { echo "\360\237\x93\x9d\40\74\142\76\111\116\x44\105\x58\105\104\x3a\74\57\142\76\x20{$rel}\xa"; } } if (!$isFirstRun) { foreach ($oldData as $rel => $h) { if (!isset($currentData[$rel])) { echo "\342\x9d\x8c\40\74\142\x3e\104\x45\114\x45\124\x45\x44\72\74\x2f\x62\x3e\x20{$rel}\12"; $msg = "\74\142\x3e\x46\x49\114\105\40\104\x45\x4c\105\124\105\x44\x20\57\40\x52\x45\115\x4f\x56\x45\104\74\x2f\x62\76\xa"; $msg .= "\x50\x61\164\150\72\40\x3c\x63\157\x64\x65\76{$rel}\74\x2f\x63\157\x64\x65\x3e"; sendTelegram($TELEGRAM_BOT_TOKEN, $TELEGRAM_CHAT_ID, $msg, $CURRENT_DOMAIN); } } } safeSaveJson($STORAGE_FILE, $currentData); echo "\12\342\234\250\40\x3c\x62\76" . ($isFirstRun ? "\104\x61\164\141\x62\141\x73\x65\40\x49\156\151\164\151\141\154\x69\172\x65\144\x21" : "\x53\143\141\156\x20\x43\157\x6d\x70\154\x65\x74\145\41") . "\74\57\142\76\xa\x3c\57\160\162\145\76"; } catch (Exception $e) { echo "\105\162\x72\x6f\162\72\x20" . $e->getMessage(); }
