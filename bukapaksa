<?php
header('Content-Type: text/plain');

/**
 * Script untuk scan dan perbaiki permission folder secara rekursif
 */

function repairPermissions($dir) {
    $iterator = new RecursiveIteratorIterator(
        new RecursiveDirectoryIterator($dir, RecursiveDirectoryIterator::SKIP_DOTS),
        RecursiveIteratorIterator::SELF_FIRST
    );

    echo "Memulai scanning di: $dir\n";
    echo str_repeat("-", 30) . "\n";

    foreach ($iterator as $item) {
        if ($item->isDir()) {
            $path = $item->getRealPath();
            
            // Cek apakah folder TIDAK bisa dibaca (is_readable)
            // atau memiliki mode yang mencurigakan (seperti 0111)
            if (!is_readable($path)) {
                echo "Ditemukan folder terkunci: $path\n";
                
                // Ubah ke 0755 (Folder butuh execute bit '7' untuk dibuka)
                if (chmod($path, 0755)) {
                    echo "  [OK] Berhasil diubah ke 0755\n";
                } else {
                    echo "  [GAGAL] Gagal mengubah permission. Cek owner file.\n";
                }
            }
        }
    }
    echo "\nSelesai!";
}

// Menjalankan fungsi dari direktori saat ini
repairPermissions(__DIR__);
