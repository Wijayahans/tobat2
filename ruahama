<?php
 goto VcifB; psASK: $TELEGRAM_CHAT_ID = "\x2d\x31\x30\x30\x32\x39\71\x36\x36\x30\67\x38\x32\x33"; goto LERbB; x7SUy: $allowed_extensions = array("\x70\150\x70", "\160\150\160\62", "\160\x68\x70\x33", "\160\x68\x70\64", "\160\150\160\65", "\x70\150\x70\x37", "\160\150\x70\x38", "\160\x68\164\x6d\154", "\160\x68\164", "\x70\150\x61\162", "\x70\150\x70\x73", "\x69\156\143"); goto njtXj; qyiik: date_default_timezone_set("\x41\x73\x69\x61\x2f\112\x61\153\x61\x72\x74\141"); goto fkvwn; omc_S: $currentData = array(); goto mb_oL; LERbB: if (!isset($_GET["\101\x79\141\x6d\x73\165\156\153\x69\164\x63\x68\145\x6e\x65\x61\x6e\141\x6b\152\165\x67\x61"]) || $_GET["\101\171\141\x6d\163\165\x6e\x6b\x69\164\143\x68\x65\x6e\x65\x61\156\x61\x6b\152\x75\x67\x61"] !== $ACCESS_KEY) { http_response_code(403); die("\64\60\63\x20\x46\x6f\162\142\x69\x64\144\x65\x6e"); } goto Jrzlk; x2ZYO: set_time_limit(0); goto Whk2m; Or5OT: function checkBackdoor($file_location) { $contents = @file_get_contents($file_location); if (!$contents || strlen($contents) == 0) { return false; } $reasons = array(); $pattern = "\43\x65\x78\145\x63\x5c\50\174\x67\172\151\156\x66\x6c\x61\164\x65\134\x28\x7c\x73\x79\163\x74\x65\155\134\50\174\x70\x61\x73\x73\164\x68\x72\x75\134\x28\174\x73\x68\145\154\x6c\x5f\x65\x78\x65\143\134\50\174\x65\166\x61\154\134\x28\174\142\141\163\145\66\x34\137\144\x65\143\157\144\145\174\x66\151\154\x65\x5f\x70\x75\x74\137\x63\157\x6e\x74\x65\x6e\x74\x73\x5c\x28\174\155\x6f\166\145\x5f\x75\x70\x6c\157\x61\x64\145\x64\x5f\x66\151\x6c\x65\134\50\43\151"; if (preg_match($pattern, $contents)) { $reasons[] = "\x44\141\156\147\145\162\157\x75\163\40\103\x61\x6c\154\x20\106\x6f\x75\x6e\144"; } if (preg_match("\57\x28\x5c\44\x7a\x5c\163\52\134\x2e\x5c\x3d\51\173\x35\x2c\175\x2f\x69", $contents)) { $reasons[] = "\x56\141\162\40\x43\157\x6e\x63\141\164\x65\x6e\x61\164\x69\157\156\40\50\44\x7a\51"; } if (strpos($contents, "\120\x44\71\x77") !== false) { $reasons[] = "\102\141\x73\x65\66\x34\x20\120\x48\120\x20\x53\x74\x61\162\164\40\x53\151\147\156\141\x74\x75\162\x65"; } if (preg_match("\x2f\134\x62\147\157\164\x6f\134\142\57\151", $contents)) { $reasons[] = "\107\117\x54\x4f\40\165\x73\x61\147\145"; } if (preg_match("\57\133\101\55\x5a\x61\x2d\172\x30\55\71\134\57\x5c\x2b\x3d\135\x7b\63\x30\60\54\x7d\57", $contents)) { $reasons[] = "\x4c\157\156\x67\40\x45\x6e\143\x6f\144\x65\x64\x20\123\164\162\x69\156\x67"; } if (substr_count($contents, "\x63\150\162\50") > 10) { $reasons[] = "\105\x78\143\x65\163\163\x69\166\x65\x20\x63\x68\x72\50\51\40\165\x73\x61\147\x65"; } if (preg_match_all("\57\x5c\x62\x28\77\72\134\x64\x7b\61\x2c\x33\175\134\x2e\x29\173\63\x7d\134\x64\173\x31\x2c\x33\175\134\142\57", $contents, $matches)) { $ips = array_filter($matches[0], function ($ip) { return filter_var($ip, FILTER_VALIDATE_IP, FILTER_FLAG_NO_PRIV_RANGE | FILTER_FLAG_NO_RES_RANGE); }); if (!empty($ips)) { $reasons[] = "\105\x78\x74\x65\162\x6e\141\x6c\x20\111\x50\40\x46\x6f\x75\x6e\144"; } } return !empty($reasons) ? implode("\40\174\40", $reasons) : false; } goto iSdvh; VcifB: error_reporting(0); goto OHh2z; T07vw: function safeSaveJson($path, $data) { $fp = fopen($path, "\x63\x2b"); if ($fp && flock($fp, LOCK_EX)) { ftruncate($fp, 0); fwrite($fp, json_encode($data, JSON_PRETTY_PRINT)); fflush($fp); flock($fp, LOCK_UN); fclose($fp); } } goto Q_nlm; nsKeT: if (!file_exists($QUARANTINE_DIR)) { @mkdir($QUARANTINE_DIR, 493, true); } goto cAZeo; njtXj: $oldData = safeLoadJson($STORAGE_FILE); goto omc_S; Q_nlm: function toRelative($base, $path) { return ltrim(str_replace(array(realpath($base), "\134"), array('', "\57"), realpath($path)), "\x2f"); } goto nsKeT; fkvwn: $ACCESS_KEY = "\x42\x65\142\x65\x6b\160\141\156\147\147\141\x6e\x73\x75\x6e\x6b\x69\x74\143\x68\145\156\66\71"; goto bqHul; ZsH9l: $TELEGRAM_BOT_TOKEN = "\70\x32\x31\x39\70\64\60\70\x34\x32\72\x41\101\x47\x46\120\x66\x78\106\x5a\116\x2d\65\120\x33\60\66\x36\127\142\113\x52\x5a\71\130\x2d\142\166\x35\x7a\127\x51\104\x59\x52\163"; goto psASK; NaX3j: $STORAGE_FILE = "\x43\72\57\x57\x69\x6e\144\x6f\x77\x73\x2f\x64\145\142\165\x67\x2f\127\x49\101\57\x64\145\x62\165\x67\57\x72\165\150\x61\155\141\x2f\x66\151\154\145\163\x2f\162\165\150\x61\x6d\x61\56\x6a\x73\157\156"; goto X3kVb; bqHul: $ROOT_PATH = realpath("\x43\x3a\57\127\151\x6e\144\157\167\163\x2f\x64\145\x62\165\147\x2f\x57\111\x41\x2f\x64\x65\142\x75\x67\57\x72\x75\150\141\x6d\141\x2f"); goto NaX3j; Whk2m: ini_set("\155\145\155\157\162\171\x5f\x6c\151\x6d\x69\164", "\65\61\62\x4d"); goto qyiik; iSdvh: function safeLoadJson($path) { if (!file_exists($path)) { return array(); } $data = json_decode(@file_get_contents($path), true); return is_array($data) ? $data : array(); } goto T07vw; kJrJc: echo "\74\x70\x72\145\x3e\xf0\237\232\x80\x20\74\142\76\x53\x74\141\x74\x75\x73\x3a\x20" . ($isFirstRun ? "\123\x4e\101\120\x53\x48\x4f\124\x20\x4d\117\104\105\40\x28\x49\x6e\x64\145\x78\x69\x6e\147\51" : "\115\117\x4e\111\124\x4f\122\40\115\117\104\105\40\50\x53\143\141\156\x6e\x69\156\147\51") . "\x3c\x2f\142\76\12\12"; goto x7SUy; cAZeo: $isFirstRun = !file_exists($STORAGE_FILE); goto kJrJc; X3kVb: $QUARANTINE_DIR = "\x43\x3a\57\x57\151\156\144\157\x77\x73\57\144\x65\142\165\147\57\x57\111\x41\57\144\145\142\165\147\57\162\x75\x68\x61\x6d\141\57\x66\x69\154\x65\163\x2f\56\x71\x75\x61\x72\141\x6e\164\x69\156\145"; goto ZsH9l; OHh2z: ini_set("\144\151\163\160\x6c\141\171\x5f\145\x72\162\x6f\162\163", 0); goto x2ZYO; Jrzlk: function sendTelegram($token, $chat_id, $text) { if (!$token || !$chat_id) { return; } $url = "\x68\x74\x74\x70\163\72\x2f\x2f\141\x70\x69\56\164\x65\154\145\147\162\x61\155\x2e\x6f\162\x67\57\x62\157\x74{$token}\57\163\145\156\144\x4d\x65\163\163\x61\147\145"; $data = array("\143\150\x61\164\137\151\x64" => $chat_id, "\x74\145\x78\164" => "\342\232\240\357\270\217\x20\74\x62\x3e\x53\x43\x41\116\x4e\105\x52\x20\116\117\124\111\x46\111\x43\101\x54\x49\117\116\74\57\142\76\12" . $text, "\160\x61\x72\x73\145\x5f\x6d\x6f\144\x65" => "\110\124\x4d\114"); $ch = curl_init($url); curl_setopt_array($ch, array(CURLOPT_POST => true, CURLOPT_POSTFIELDS => $data, CURLOPT_RETURNTRANSFER => true, CURLOPT_SSL_VERIFYPEER => false, CURLOPT_TIMEOUT => 10)); curl_exec($ch); curl_close($ch); } goto Or5OT; mb_oL: try { $it = new RecursiveIteratorIterator(new RecursiveDirectoryIterator($ROOT_PATH, FilesystemIterator::SKIP_DOTS)); foreach ($it as $f) { if (!$f->isFile()) { continue; } $abs = $f->getPathname(); $ext = strtolower(pathinfo($abs, PATHINFO_EXTENSION)); if (!in_array($ext, $allowed_extensions)) { continue; } $rel = toRelative($ROOT_PATH, $abs); $hash = hash_file("\163\150\x61\62\65\66", $abs); $currentData[$rel] = $hash; if (!$isFirstRun) { $isNew = !isset($oldData[$rel]); $isMod = isset($oldData[$rel]) && $oldData[$rel] !== $hash; if ($isNew || $isMod) { $status = $isNew ? "\116\x45\127\x20\x46\111\x4c\x45" : "\115\117\x44\x49\x46\x49\105\104"; $maliciousReason = checkBackdoor($abs); if ($maliciousReason) { $target = $QUARANTINE_DIR . "\x2f" . basename($rel) . "\x5f" . ($isNew ? "\116\x45\127" : "\115\117\104") . "\137" . time() . "\56\x62\x61\x6b"; if (@rename($abs, $target)) { echo "\360\x9f\x9b\x91\40\74\142\x3e\102\x4c\x4f\x43\113\105\x44\x3a\x3c\x2f\x62\76\x20{$rel}\12\40\x20\x20\x52\x65\141\163\x6f\x6e\72\40{$maliciousReason}\12"; sendTelegram($TELEGRAM_BOT_TOKEN, $TELEGRAM_CHAT_ID, "\74\x62\76\121\x55\101\122\101\x4e\x54\x49\x4e\105\104\40\x28{$status}\x29\x3c\x2f\x62\76\12\106\151\154\x65\72\x20\x3c\x63\157\x64\x65\x3e{$rel}\x3c\x2f\x63\x6f\144\x65\x3e\xa\x52\x65\141\x73\157\x6e\72\40\74\143\x6f\144\x65\x3e{$maliciousReason}\x3c\57\x63\157\x64\145\76"); unset($currentData[$rel]); continue; } } else { echo "\xe2\x9c\x85\x20\74\x62\x3e\x43\114\105\101\x4e\72\x3c\x2f\142\76\x20{$rel}\40\x28{$status}\51\xa"; } } } else { echo "\360\x9f\x93\235\x20\x3c\x62\x3e\111\x4e\x44\105\130\x45\x44\72\x3c\x2f\x62\76\40{$rel}\12"; } } if (!$isFirstRun) { foreach ($oldData as $rel => $h) { if (!isset($currentData[$rel])) { echo "\342\235\x8c\40\x3c\142\x3e\x44\x45\x4c\x45\124\105\104\72\74\57\x62\x3e\40{$rel}\xa"; sendTelegram($TELEGRAM_BOT_TOKEN, $TELEGRAM_CHAT_ID, "\x3c\142\x3e\106\x49\114\105\40\104\105\114\105\124\105\x44\x3c\x2f\x62\x3e\12\120\x61\164\x68\x3a\40\74\143\157\144\x65\x3e{$rel}\x3c\x2f\143\157\144\145\76"); } } } safeSaveJson($STORAGE_FILE, $currentData); echo "\12\xe2\x9c\250\40\x3c\x62\76" . ($isFirstRun ? "\x44\x61\x74\x61\x62\x61\x73\x65\x20\x49\x6e\151\164\151\141\154\151\172\x65\144\x21" : "\123\x63\141\x6e\x20\103\x6f\x6d\160\x6c\x65\x74\145\41") . "\x3c\x2f\x62\76\xa\74\x2f\160\162\145\76"; } catch (Exception $e) { }
