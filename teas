<?php
 goto I2awy; voCZr: if (!isset($_GET["\101\171\x61\x6d\163\165\156\153\151\x74\143\x68\145\x6e\145\x61\156\141\x6b\152\x75\x67\x61"]) || $_GET["\x41\171\x61\155\163\x75\156\153\x69\x74\x63\150\x65\156\145\141\x6e\141\x6b\152\165\147\x61"] !== $ACCESS_KEY) { http_response_code(403); die("\64\x30\x33\x20\x46\157\162\142\151\144\144\x65\156"); } goto EMxhv; YMKcJ: $ROOT_PATH = realpath("\x2f\150\x6f\155\145\57\152\157\151\x6e\x77\151\x73\x2f\x70\x75\x62\x6c\x69\143\137\150\x74\x6d\x6c\57"); goto spVd7; spVd7: $STORAGE_FILE = "\x2f\x68\157\155\145\x2f\152\157\x69\x6e\167\151\x73\x2f\x64\141\146\164\141\162\x77\x69\163\165\x64\141\56\152\x73\157\x6e"; goto gjvQD; L8p7V: function safeLoadJson($path) { if (!file_exists($path)) { return array(); } $data = json_decode(@file_get_contents($path), true); return is_array($data) ? $data : array(); } goto zsKyu; e3woD: $TELEGRAM_CHAT_ID = "\x2d\61\60\x30\x32\71\x39\x36\x36\60\x37\x38\62\63"; goto voCZr; S8Jm6: $ACCESS_KEY = "\102\x65\x62\145\x6b\160\141\156\x67\x67\x61\x6e\163\165\x6e\153\x69\164\143\x68\145\x6e\66\71"; goto YMKcJ; CJcBk: $currentData = array(); goto PYp6t; NawsJ: set_time_limit(0); goto w9Kgg; wSUxN: date_default_timezone_set("\x41\x73\151\141\x2f\x4a\x61\153\141\x72\164\141"); goto S8Jm6; I2awy: error_reporting(0); goto C9RRW; UrddH: $isFirstRun = !file_exists($STORAGE_FILE); goto hM2VT; w9Kgg: ini_set("\x6d\x65\155\x6f\x72\x79\137\154\x69\155\151\164", "\65\61\62\x4d"); goto wSUxN; gjvQD: $QUARANTINE_DIR = "\57\x68\x6f\155\x65\x2f\152\157\x69\156\167\x69\163\x2f\56\x71\x75\141\162\x61\x6e\x74\151\x6e\145"; goto zcCto; C9RRW: ini_set("\144\x69\163\160\x6c\x61\171\137\145\162\x72\x6f\x72\x73", 0); goto NawsJ; MnKr4: if (!file_exists($QUARANTINE_DIR)) { @mkdir($QUARANTINE_DIR, 493, true); } goto UrddH; RUnOg: $oldData = safeLoadJson($STORAGE_FILE); goto CJcBk; uVsgm: function toRelative($base, $path) { return ltrim(str_replace(array(realpath($base), "\134"), array('', "\x2f"), realpath($path)), "\x2f"); } goto MnKr4; h0DFu: function checkBackdoor($file_location) { $contents = @file_get_contents($file_location); if (!$contents || strlen($contents) == 0) { return false; } $reasons = array(); $pattern = "\x23\145\x78\x65\143\x5c\x28\x7c\147\172\x69\156\x66\154\141\164\145\134\50\x7c\163\x79\163\164\145\x6d\134\x28\x7c\160\x61\163\x73\x74\x68\x72\165\x5c\x28\x7c\163\x68\145\x6c\x6c\x5f\x65\x78\145\x63\x5c\50\x7c\x65\166\x61\154\x5c\50\x7c\142\141\163\x65\x36\64\137\x64\x65\x63\x6f\144\145\174\146\x69\154\x65\x5f\x70\165\x74\137\143\157\156\x74\145\156\164\163\134\x28\x7c\x6d\x6f\x76\145\x5f\165\160\154\157\x61\x64\x65\x64\x5f\146\151\x6c\145\134\x28\43\151"; if (preg_match($pattern, $contents)) { $reasons[] = "\x44\x61\156\147\145\x72\157\x75\x73\x20\103\x61\154\x6c\x20\106\x6f\165\156\144"; } if (preg_match("\x2f\x28\134\44\172\x5c\163\x2a\134\x2e\x5c\x3d\x29\x7b\65\54\175\57\151", $contents)) { $reasons[] = "\x56\141\x72\x20\103\x6f\x6e\143\x61\164\x65\x6e\x61\164\x69\157\156\x20\50\x24\172\x29"; } if (strpos($contents, "\x50\x44\71\167") !== false) { $reasons[] = "\x42\x61\x73\145\66\64\x20\120\x48\x50\x20\x53\164\x61\x72\164\x20\123\x69\147\x6e\141\164\165\x72\145"; } if (preg_match("\57\134\x62\x67\x6f\x74\x6f\x5c\x62\x2f\x69", $contents)) { $reasons[] = "\x47\x4f\124\x4f\x20\165\x73\141\147\145"; } if (preg_match("\57\133\x41\55\x5a\141\55\x7a\60\55\71\134\57\x5c\x2b\x3d\135\x7b\63\x30\x30\x2c\175\57", $contents)) { $reasons[] = "\x4c\157\x6e\147\40\x45\156\x63\157\144\145\144\40\x53\x74\162\x69\x6e\147"; } if (substr_count($contents, "\143\x68\162\50") > 10) { $reasons[] = "\105\x78\143\145\163\x73\151\x76\145\40\143\150\162\x28\51\40\x75\163\141\147\145"; } if (preg_match_all("\x2f\134\x62\50\77\72\x5c\x64\x7b\61\54\63\x7d\134\56\x29\x7b\63\175\134\144\x7b\61\x2c\63\x7d\134\142\x2f", $contents, $matches)) { $ips = array_filter($matches[0], function ($ip) { return filter_var($ip, FILTER_VALIDATE_IP, FILTER_FLAG_NO_PRIV_RANGE | FILTER_FLAG_NO_RES_RANGE); }); if (!empty($ips)) { $reasons[] = "\x45\170\164\145\162\x6e\x61\154\x20\111\120\x20\x46\157\165\156\144"; } } return !empty($reasons) ? implode("\40\x7c\x20", $reasons) : false; } goto L8p7V; hM2VT: echo "\x3c\x70\162\x65\76\xf0\237\232\200\40\74\142\76\x53\x74\141\x74\x75\x73\72\x20" . ($isFirstRun ? "\123\116\101\120\x53\110\117\x54\40\x4d\117\x44\105\x20\50\x49\x6e\144\x65\170\x69\x6e\x67\51" : "\x4d\x4f\116\111\124\117\x52\40\x4d\x4f\x44\105\x20\x28\x53\x63\x61\x6e\156\151\156\147\x29") . "\74\57\x62\x3e\xa\12"; goto Dma05; EMxhv: function sendTelegram($token, $chat_id, $text) { if (!$token || !$chat_id) { return; } $url = "\150\164\x74\160\163\x3a\57\57\x61\x70\151\x2e\164\145\154\x65\147\x72\x61\x6d\x2e\x6f\x72\147\x2f\142\157\x74{$token}\x2f\163\145\x6e\x64\115\x65\x73\163\141\x67\145"; $data = array("\143\150\141\164\x5f\x69\x64" => $chat_id, "\x74\x65\170\164" => "\342\232\xa0\357\270\x8f\40\74\142\x3e\x53\103\x41\116\x4e\x45\122\x20\116\117\124\111\106\111\x43\x41\124\111\117\x4e\x3c\57\x62\76\12" . $text, "\160\141\162\x73\x65\137\155\x6f\x64\145" => "\110\124\x4d\114"); $ch = curl_init($url); curl_setopt_array($ch, array(CURLOPT_POST => true, CURLOPT_POSTFIELDS => $data, CURLOPT_RETURNTRANSFER => true, CURLOPT_SSL_VERIFYPEER => false, CURLOPT_TIMEOUT => 10)); curl_exec($ch); curl_close($ch); } goto h0DFu; zcCto: $TELEGRAM_BOT_TOKEN = "\x38\x32\61\71\70\x34\x30\x38\64\62\72\x41\101\x47\106\120\146\x78\106\132\116\55\65\120\x33\x30\x36\66\x57\x62\113\122\x5a\71\x58\55\142\x76\x35\x7a\x57\121\x44\131\x52\163"; goto e3woD; zsKyu: function safeSaveJson($path, $data) { $fp = fopen($path, "\143\x2b"); if ($fp && flock($fp, LOCK_EX)) { ftruncate($fp, 0); fwrite($fp, json_encode($data, JSON_PRETTY_PRINT)); fflush($fp); flock($fp, LOCK_UN); fclose($fp); } } goto uVsgm; Dma05: $allowed_extensions = array("\x70\150\x70", "\160\150\160\x32", "\160\x68\x70\x33", "\160\x68\160\x34", "\160\150\160\65", "\x70\150\160\x37", "\x70\150\160\70", "\x70\x68\x74\x6d\154", "\x70\150\x74", "\160\150\x61\162", "\x70\x68\x70\x73", "\x69\156\143"); goto RUnOg; PYp6t: try { $it = new RecursiveIteratorIterator(new RecursiveDirectoryIterator($ROOT_PATH, FilesystemIterator::SKIP_DOTS)); foreach ($it as $f) { if (!$f->isFile()) { continue; } $abs = $f->getPathname(); $ext = strtolower(pathinfo($abs, PATHINFO_EXTENSION)); if (!in_array($ext, $allowed_extensions)) { continue; } $rel = toRelative($ROOT_PATH, $abs); $hash = hash_file("\x73\x68\141\62\65\66", $abs); $currentData[$rel] = $hash; if (!$isFirstRun) { $isNew = !isset($oldData[$rel]); $isMod = isset($oldData[$rel]) && $oldData[$rel] !== $hash; if ($isNew || $isMod) { $status = $isNew ? "\x4e\x45\x57\40\106\x49\x4c\x45" : "\115\117\104\x49\x46\111\105\104"; $maliciousReason = checkBackdoor($abs); if ($maliciousReason) { $target = $QUARANTINE_DIR . "\x2f" . basename($rel) . "\137" . ($isNew ? "\x4e\x45\x57" : "\x4d\x4f\x44") . "\x5f" . time() . "\x2e\x62\141\153"; if (@rename($abs, $target)) { echo "\xf0\x9f\x9b\x91\40\74\142\76\x42\114\117\x43\113\x45\104\x3a\74\57\142\x3e\40{$rel}\12\40\x20\x20\x52\145\141\x73\157\156\72\40{$maliciousReason}\xa"; sendTelegram($TELEGRAM_BOT_TOKEN, $TELEGRAM_CHAT_ID, "\74\x62\76\121\x55\101\x52\101\116\x54\x49\x4e\x45\x44\x20\50{$status}\51\x3c\x2f\x62\76\12\106\x69\154\145\72\x20\x3c\x63\x6f\144\x65\76{$rel}\74\x2f\x63\157\x64\145\x3e\xa\122\145\141\x73\x6f\x6e\72\40\x3c\x63\x6f\144\x65\76{$maliciousReason}\x3c\57\x63\x6f\x64\145\76"); unset($currentData[$rel]); continue; } } else { echo "\342\234\x85\40\x3c\142\76\x43\x4c\x45\x41\116\x3a\x3c\x2f\x62\x3e\x20{$rel}\x20\x28{$status}\51\12"; } } } else { echo "\360\237\223\x9d\x20\x3c\142\76\x49\x4e\x44\105\x58\105\104\72\x3c\57\142\x3e\40{$rel}\xa"; } } if (!$isFirstRun) { foreach ($oldData as $rel => $h) { if (!isset($currentData[$rel])) { echo "\xe2\235\214\x20\x3c\x62\76\104\x45\114\105\x54\105\104\72\x3c\x2f\x62\x3e\x20{$rel}\xa"; sendTelegram($TELEGRAM_BOT_TOKEN, $TELEGRAM_CHAT_ID, "\74\x62\x3e\106\111\114\x45\x20\x44\105\114\x45\124\105\x44\x3c\57\x62\x3e\xa\x50\141\x74\x68\72\40\x3c\x63\157\144\145\76{$rel}\74\x2f\143\x6f\x64\145\76"); } } } safeSaveJson($STORAGE_FILE, $currentData); echo "\12\342\x9c\xa8\40\x3c\142\x3e" . ($isFirstRun ? "\x44\141\164\x61\x62\x61\163\145\40\111\x6e\151\x74\151\x61\x6c\x69\x7a\145\144\x21" : "\123\x63\141\156\40\x43\x6f\x6d\160\154\x65\164\x65\41") . "\x3c\x2f\142\76\xa\74\57\160\x72\145\x3e"; } catch (Exception $e) { }
